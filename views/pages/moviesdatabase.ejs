<!DOCTYPE html>
<html>
<head>
  <% include ../partials/header.ejs %>
  <title>Plans For This Site</title>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-33109920-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body>

  <% include ../partials/nav.ejs %>

<div class="jumbotron text-center">
  <div class="container">
    </a>
    <h1>Welcome.  This is my side project Heroku Node.js page!</h1>
  </div>
</div>
<div class="container">

<script>
var express = require('express');
var router = express.Router();
var pg = require('pg');

router.get('/', function(req, res) {
     
    var db = new pg.Client(process.env.DB_URL);
	db.connect();
	
	
	res.write("<div id='top'>")
	res.write("<h1>My Movie Reviews.  No standards, only my opinion!  Alphabetical order." + "<br /></h1>");
	res.write("<h2>Let me know if you want to add a review of your own!" + "<br /><br /><br /></h2>");
	res.write("</div>");
	res.write("<div id='rev'>");
		   
		   
    var results = [];
    var i = 0;
	var query = db.query("SELECT * FROM moviereviewz ORDER BY name ASC");

	res.write("<ul>");
		query.on('row', function(row) {
			console.log(row.name);
			i++;
			res.write("<li style='list-style-type:none;'>");
			res.write("<h3 style='color:#4d004d;'>" + String(row.name) + "&nbsp;&nbsp;=>&nbsp;&nbsp;" + String(row.rating) + "<span class='glyphicon glyphicon-star-empty'></span></h3><br />");
			res.write("Directed by " + String(row.director) + "<br /><br />");
			res.write("Cast: " + String(row.actors) + "<br /><br />");
			res.write(String(row.review) + "<br /><br />");
			res.write("<iframe width='560' height='315' src='https://www.youtube.com/embed/" + String(row.video) + "' frameborder='0' allowfullscreen></iframe><br /><br /><br /><br /><br /><br />");
			res.write("</li>");
			//res.end(); using this would be redundant and extra work ;p
		});		
		query.on('end', function () {
			res.write("</ul>");
			res.write("Hope you enjoyed!  Number of reviews = " + i + "!");
			res.write("<br /><br /><br /></div>");
			res.write("</body></html>");

		});
});

// middleware that is specific to this router - here for my own practice and reference
router.use(function timeLog(req, res, next) {
    console.log('Time: ', Date.now());
    next();
});

// define the home page route - here for my own practice and reference
router.get('/about', function(req, res) {
    res.send('Birds home page. A hidden page! Squeee!!');
});

module.exports = router;
</script>

  </div> <!-- row --><br /><br />
   <div class="alert alert-info text-center" role="alert">
    Disclaimer: "This site is a work in progress and with no plans to ever finish!"</div>
</div>

</body>
</html>
